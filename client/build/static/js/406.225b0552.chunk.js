(self.webpackChunkmillegrilles_maitredescomptes_client=self.webpackChunkmillegrilles_maitredescomptes_client||[]).push([[406],{55428:function(e,r,t){var n=t(57730),i=t(8497);var a={KIND_DOCUMENT:0,KIND_REQUETE:1,KIND_COMMANDE:2,KIND_TRANSACTION:3,KIND_REPONSE:4,KIND_EVENEMENT:5,KIND_REPONSE_CHIFFREE:6,KIND_TRANSACTION_MIGREE:7,KIND_COMMANDE_INTER_MILLEGRILLE:8},o=[1,2,3,5];e.exports={CONST_COMMANDE_AUTH:1,CONST_COMMANDE_SIGNER_CSR:2,getMimetypeExtMap:function(){return n},getExtMimetypeMap:function(){return i},KIND_DOCUMENT:0,KIND_REQUETE:1,KIND_COMMANDE:2,KIND_TRANSACTION:3,KIND_REPONSE:4,KIND_EVENEMENT:5,KIND_REPONSE_CHIFFREE:6,MESSAGE_KINDS:a,MESSAGEE_KINDS_ROUTAGE:o}},59740:function(e,r,t){var n=t(19778).Buffer,i=t(17061).default,a=t(861).default,o=t(42122).default,c=t(17156).default,u=t(93744).default,f=t(56690).default,s=t(89728).default,l=t(2748)("millegrilles:forgecommon"),d=t(98667).pki,p=t(90370),v=t(29781).hacher,E=t(90676),m=E.verifierIdmg,h=E.getIdmg,g=t(86604).getRandom,y="-----BEGIN PUBLIC KEY-----",C="-----END PUBLIC KEY-----",b="-----BEGIN PRIVATE KEY-----",N="-----END PRIVATE KEY-----",I="-----BEGIN CERTIFICATE-----";function P(e){return e.split(I).map((function(e){return(I+e).trim()})).slice(1)}var D=function(){"use strict";function e(r,t){var n;f(this,e),t||(t={}),this.DEBUG=t.DEBUG,n=t.isPEM||"string"===typeof r?d.certificateFromPem(r):r,this.DEBUG&&console.debug("Certificat de millegrille (CA) charge : %O",n),this.caStore=d.createCaStore([n]),this.cert=n}return s(e,[{key:"verifierChaine",value:function(e,r){r||(r={});var t=e.map((function(e){return"string"!==typeof e?e:d.certificateFromPem(e)}));this.DEBUG&&r.validityCheckDate&&console.debug("Date validation certificats %s",r.validityCheckDate);var n=!0;try{d.verifyCertificateChain(this.caStore,t,r)}catch(a){n=!1,this.DEBUG&&console.debug("Certificate verification failure: %s",JSON.stringify(a,null,2))}if(!0===n){var i=t.shift();return i.chain=t,i}return!1}}]),e}();function K(){return(K=c(i().mark((function e(r,t){var n,a,o,c,u,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l("validerChaineCertificats chainePEM : %O, opts: %O",r,t),"string"===typeof r&&(r=P(r)),!(r.length>3)){e.next=4;break}throw new Error("Chaine de certificat > 3, le cross-signing n'est pas supporte pour l'authentification web");case 4:if(t||(t={}),n=t.ca||t.certCa){e.next=8;break}throw new Error("forgecommon Chaine incomplete, il manque le CA : "+r);case 8:if(d.certificateFromPem(n),a=t.clientStore||new D(n,{isPEM:!0}),a.verifierChaine(r)){e.next=13;break}throw new Error("forgecommon Chaine de certificats invalide");case 13:return o=d.certificateFromPem(r[0]),e.next=16,h(r);case 16:if(c=e.sent,!(u=t.idmg)||c===u){e.next=22;break}throw new Error("forgecommonCertificat (O="+c+") ne corespond pas au IDMG "+t.idmg);case 22:m(c,n),u=c;case 24:if((f=o.issuer.getField("O").value)===u){e.next=27;break}throw new Error("forgecommon Certificat intermediaire (O="+f+") ne corespond pas au IDMG calcule "+u);case 27:return e.abrupt("return",{cert:o,idmg:f,idmgCa:u,clientStore:a});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={chiffrerPrivateKeyPEM:function(e,r){var t=d.privateKeyFromPem(e);return d.encryptRsaPrivateKey(t,r)},enveloppePEMPublique:function(e){return[y,e,C].join("\n")},enveloppePEMPrivee:function(e){return[b,e,N].join("\n")},matchCertificatKey:function(e,r){var t=d.certificateFromPem(e),n=d.privateKeyFromPem(r);return 0===t.publicKey.n.compareTo(n.n)},CertificateStore:D,genererRandomSerial:function(){var e=g(8),r=""+new BigUint64Array(e.buffer)[0];return r.length<2&&u("serial"),r},splitPEMCerts:P,chargerClePrivee:function(e,r){return(r=r||{}).password?d.decryptRsaPrivateKey(e,r.password):d.privateKeyFromPem(e)},chiffrerPrivateKey:function(e,r){return d.encryptRsaPrivateKey(e,r)},validerChaineCertificats:function(e,r){return K.apply(this,arguments)},verifierChallengeCertificat:function(e,r){var t=r._signature;if(!t)throw new Error("forgecommon Signature introuvable");var n=o({},r);delete n._signature,delete n._signatures;var i=p(n);return verifierSignatureString(e.publicKey,i,t)},sauvegarderPrivateKeyToPEM:function(e){var r=d.privateKeyToAsn1(e),t=d.wrapRsaPrivateKey(r);return d.privateKeyInfoToPem(t)},comparerArraybuffers:function(e,r){if(e.byteLength!=r.byteLength)return!1;for(var t=new Int8Array(e),n=new Int8Array(r),i=0;i!=e.byteLength;i++)if(t[i]!=n[i])return!1;return!0},extraireExtensionsMillegrille:function(e){"string"===typeof e&&(e=d.certificateFromPem(e));var r="";try{var t=e.extensions.filter((function(e){return"1.2.3.4.0"===e.id})).map((function(e){return e.value.split(",")}));r=t.reduce((function(e,r){return[].concat(a(e),a(r))}),[])}catch(m){}var n="";try{var i=e.extensions.filter((function(e){return"1.2.3.4.1"===e.id})).map((function(e){return e.value.split(",")}));n=i.reduce((function(e,r){return[].concat(a(e),a(r))}),[])}catch(m){}var o="";try{var c=e.extensions.filter((function(e){return"1.2.3.4.2"===e.id}));c&&c[0]&&(o=c[0].value)&&(o=o.split(","))}catch(m){}var u="";try{u=e.extensions.filter((function(e){return"1.2.3.4.3"===e.id}))[0].value}catch(m){}var f="";try{var s=e.extensions.filter((function(e){return"1.2.3.4.4"===e.id}));s&&s[0]&&(f=s[0].value)}catch(m){}var l="";try{var p=e.extensions.filter((function(e){return"1.2.3.4.5"===e.id}));p&&p[0]&&(l=p[0].value)&&(l=l.split(","))}catch(m){}var v="";try{var E=e.extensions.filter((function(e){return"1.2.3.4.6"===e.id}));E&&E[0]&&(v=E[0].value)&&(v=v.split(","))}catch(m){}return{roles:n,niveauxSecurite:r,userId:u,delegationGlobale:f,delegationsDomaines:l,delegationsSousDomaines:v,domaines:o}},hacherPem:function(e,r){var t=(r=r||{}).hashingCode||"sha2-256",i=r.encoding||"base64",a=e.trim().split("\n"),o=(a=a.slice(1,a.length-1)).join("");console.debug("Pem sans enveloppe : %O",o);var c=new Uint8Array(n.from(o,"base64"));return console.debug("Buffer pem : %O",c),v(c,{hashingCode:t,encoding:i})}}},20809:function(e,r,t){"use strict";var n=t(19778).Buffer;var i=t(86673);function a(e,r){return void 0===r&&(r="utf8"),n.isBuffer(e)?c(e.toString("base64")):c(n.from(e,r).toString("base64"))}function o(e){return e=e.toString(),i.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function c(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var u=a;u.encode=a,u.decode=function(e,r){return void 0===r&&(r="utf8"),n.from(o(e),"base64").toString(r)},u.toBase64=o,u.fromBase64=c,u.toBuffer=function(e){return n.from(o(e),"base64")},r.default=u},86673:function(e,r,t){"use strict";var n=t(19778).Buffer;Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var r=e.length,t=r%4;if(!t)return e;var i=r,a=4-t,o=r+a,c=n.alloc(o);for(c.write(e);a--;)c.write("=",i++);return c.toString()}},86948:function(e,r,t){e.exports=t(20809).default,e.exports.default=e.exports},24214:function(e,r,t){"use strict";var n=t(40204),i=t(37553),a=i.encodeText,o=i.decodeText,c=i.concat;function u(e){if(Object.prototype.hasOwnProperty.call(n.names,e))return n.names[e];if(Object.prototype.hasOwnProperty.call(n.codes,e))return n.codes[e];throw new Error("Unsupported encoding: ".concat(e))}(r=e.exports=function(e,r){if(!r)throw new Error("requires an encoded Uint8Array");var t=u(e),n=t.name,i=t.codeBuf;return function(e,r){var t=u(e);t.decode(o(r))}(n,r),c([i,r],i.length+r.length)}).encode=function(e,r){var t=u(e),n=a(t.encode(r));return c([t.codeBuf,n],t.codeBuf.length+n.length)},r.decode=function(e){e instanceof Uint8Array&&(e=o(e));var r=e[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(r)&&(e=e.toLowerCase()),u(e[0]).decode(e.substring(1))},r.isEncoded=function(e){if(e instanceof Uint8Array&&(e=o(e)),"[object String]"!==Object.prototype.toString.call(e))return!1;try{return u(e[0]).name}catch(r){return!1}},r.encoding=u,r.encodingFromData=function(e){return e instanceof Uint8Array&&(e=o(e)),u(e[0])};var f=Object.freeze(n.names),s=Object.freeze(n.codes);r.names=f,r.codes=s},84797:function(e,r,t){"use strict";t.r(r),t.d(r,{base64:function(){return i},base64pad:function(){return a},base64url:function(){return o},base64urlpad:function(){return c}});var n=t(58552),i=(0,n.ET)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),a=(0,n.ET)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o=(0,n.ET)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),c=(0,n.ET)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})}}]);
//# sourceMappingURL=406.225b0552.chunk.js.map