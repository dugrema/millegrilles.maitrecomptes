"use strict";(self.webpackChunkmillegrilles_maitredescomptes_client=self.webpackChunkmillegrilles_maitredescomptes_client||[]).push([[682],{67682:function(e,n,t){t.r(n),t.d(n,{connecter:function(){return c}});var r=t(1413),s=t(74165),i=t(15861),a=t(61555),o="/millegrilles/socket.io";function c(e,n,t,r){return u.apply(this,arguments)}function u(){return(u=(0,i.Z)((0,s.Z)().mark((function e(n,t,r,i){var c,u,f,p,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.connexion,(u=new URL(window.location.href)).pathname=o,f=(0,a.sj)((function(e){return l(n,e,t)})),p=(0,a.sj)(r),g=(0,a.sj)(i),e.next=8,c.setCallbacks(p,f,g);case 8:return console.info("Connecter a %O",u.href),e.abrupt("return",c.connecter(u.href,{DEBUG:!0}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,n,t,r){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)((0,s.Z)().mark((function e(n,i,a,o){var c,u,l,f,p,g,m,h,d,x,b,k,w,U,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||{},console.debug("setUsager nomUsager %O, opts %O",i,o),e.next=4,a("");case 4:return e.next=6,Promise.resolve().then(t.bind(t,20829));case 6:return c=e.sent,u=c.usagerDao,l=c.forgecommon,e.next=11,Promise.resolve().then(t.t.bind(t,83653,23));case 11:return f=e.sent,p=f.pki,g=l.extraireExtensionsMillegrille,e.next=16,u.getUsager(i);case 16:if(m=e.sent,console.debug("Usager info : %O",m),!m||!m.certificat){e.next=37;break}return h=n.connexion,d=m.certificat,x=d.join(""),e.next=24,h.initialiserFormatteurMessage(x,m.clePriveePem,{DEBUG:!1});case 24:return b=p.certificateFromPem(d[0]),k=g(b),w=k.userId,console.debug("setUsager Authentifier %s, %O",i,k),e.next=30,n.connexion.authentifier(null,{noCallback:!0});case 30:return U=e.sent,console.debug("setUsager Reponse authentifier : %O",U),v=U.protege,U.delegations_date,U.delegations_version,U.certificat,U.ca,e.next=35,a((0,r.Z)((0,r.Z)({},m),{},{userId:w,nomUsager:i,extensions:k,auth:v}));case 35:e.next=38;break;case 37:console.warn("Pas de certificat pour l'usager '%s'",m);case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=682.91dfbb69.chunk.js.map