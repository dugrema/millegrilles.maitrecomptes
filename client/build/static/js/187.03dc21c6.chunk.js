"use strict";(self.webpackChunkmillegrilles_maitredescomptes_client=self.webpackChunkmillegrilles_maitredescomptes_client||[]).push([[187],{61187:function(e,n,r){r.r(n);var t=r(74165),i=r(15861),c=r(29439),s=r(72791),a=r(30018),o=r(43360),u=r(89743),l=r(2677),d=r(75630),h=(r(1827),r(20829)),p=r(7087),f=r(96128),m=r(58516),g=r(80184);function x(e){var n=e.erreurCb,r=(0,p.ZP)(),a=(0,p.ZY)()[0],o=(0,p.cd)()[0],u=(0,p.wg)(),l=a.nomUsager,x=(0,s.useState)(!1),v=(0,c.Z)(x,2),j=v[0],b=v[1],C=(0,s.useState)(""),Z=(0,c.Z)(C,2),w=Z[0],k=Z[1],A=(0,s.useState)(""),z=(0,c.Z)(A,2),R=z[0],S=z[1],O=(0,s.useState)(""),y=(0,c.Z)(O,2),U=y[0],_=y[1],q=(0,s.useState)(""),E=(0,c.Z)(q,2),G=E[0],N=E[1],F=(0,s.useCallback)((function(e){console.debug("Recu csr : %O",e),k(e)}),[k]),K=(0,s.useCallback)((function(){var e=r.connexion,c=U.demandeCertificat,s=U.publicKey,a=window.location.hostname;N("attente"),(0,m.Cc)(l,c,s).then(function(){var r=(0,i.Z)((0,t.Z)().mark((function r(i){var c,s;return(0,t.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.debug("Resultat signature webauthn : %O",i),c={demandeCertificat:i.demandeCertificat,clientAssertionResponse:i.webauthn,origin:a,hostname:a,challenge:R},console.debug("Commande demande signature : %O",c),r.next=5,e.signerRecoveryCsr(c);case 5:s=r.sent,console.debug("Reponse signature certificat : %O",s),s.err?(N("echec"),n(s.err,"Erreur lors de l'activation du code")):N("succes");case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()).catch((function(e){N("echec"),n(e)}))}),[r,l,R,U,N,n]);return(0,s.useEffect)((function(){(0,h.supporteCamera)().then((function(e){return b(e)})).catch((function(e){return n(e)}))}),[b,n]),(0,s.useEffect)((function(){if(w){console.debug("Generer challenge pour %O\nUsager socketio %O\nCSR %s",a,o,w);var e=window.location.hostname;r.connexion.genererChallenge({hostname:e,webauthnAuthentication:!0}).then((function(e){console.debug("Challenge webauthn : ",e);var n=e.authentication_challenge;return S(n.publicKey.challenge),(0,m.se)(l,n,w,{activationTierce:!0})})).then((function(e){console.debug("Challenge webauthn prepare : ",e),_(e)})).catch(n)}}),[l,o,w,_,S,n]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("h2",{children:"Activer compte"}),(0,g.jsx)(f.Z,{children:(0,g.jsx)(h.AfficherActivationsUsager,{nomUsager:l,workers:r,supportCodeQr:j,csrCb:F,erreurCb:n})}),(0,g.jsx)("br",{}),(0,g.jsx)(d.Z.Group,{children:(0,g.jsx)(d.Z.Text,{className:"text-muted",children:"Saisissez un code et cliquez sur Activer."})}),(0,g.jsx)(h.BoutonActif,{onClick:K,etat:G,disabled:!w||!u,children:"Activer"})]})}n.default=function(e){var n=e.fermer,r=e.erreurCb;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(u.Z,{children:[(0,g.jsx)(l.Z,{xs:10,md:11,children:(0,g.jsx)("h2",{children:"Activer un appareil"})}),(0,g.jsx)(l.Z,{xs:2,md:1,className:"bouton",children:(0,g.jsx)(o.Z,{onClick:n,variant:"secondary",children:(0,g.jsx)("i",{className:"fa fa-remove"})})})]}),(0,g.jsx)("p",{children:"Cette section permet d'activer votre compte sur un autre appareil ou site lie a cette MilleGrille."}),(0,g.jsx)(x,{erreurCb:r}),(0,g.jsx)("hr",{}),(0,g.jsxs)(a.Z,{variant:"dark",show:!0,children:[(0,g.jsx)(a.Z.Heading,{children:"Instructions"}),(0,g.jsx)("p",{children:"Pour proceder, vous devez obtenir un code sur votre autre appareil ou site. Le code est genere lors d'un echec d'authentification."}),(0,g.jsxs)("ol",{children:[(0,g.jsx)("li",{children:"Utiliser votre autre appareil, ou ce navigateur pour aller sur le site"}),(0,g.jsx)("li",{children:"Choisissez/entrez votre nom d'usager"}),(0,g.jsx)("li",{children:"Cliquez sur suivant"}),(0,g.jsx)("li",{children:"Cliquez sur Annuler ou attendez 1 minute."}),(0,g.jsx)("li",{children:"La page avec l'information d'activation de compte est affichee."}),(0,g.jsx)("li",{children:"Revenir sur cette page et entrer le code (e.g. jdzl-a7u7) ou scanner le code QR."})]})]})]})}}}]);
//# sourceMappingURL=187.03dc21c6.chunk.js.map