(self.webpackChunkmillegrilles_maitredescomptes_client=self.webpackChunkmillegrilles_maitredescomptes_client||[]).push([[585],{50585:function(e,n,t){"use strict";t.r(n);var r=t(74165),a=t(15861),i=t(29439),c=t(72791),o=t(36957),s=t(91941),u=t(1481),l=t(22020),p=t(2869),f=t(20829),d=t(7087),m=t(74405),h=t(93183),v=t.n(h),g=t(80184);function b(){return(b=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Deconnecter"),e.next=3,(0,m.L5)();case 3:return e.next=5,n.connexion.deconnecter();case 5:window.location="/auth/deconnecter_usager";case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.default=function(e){var n=e.i18n,t=e.setSectionAfficher,r=(0,d.ZP)(),a=(0,l.$)().t,m=(0,d.Sy)(),h=(0,c.useState)(!1),y=(0,i.Z)(h,2),x=y[0],k=y[1],w=(0,c.useCallback)((function(){return k(!1)}),[k]),Z=(0,c.useMemo)((function(){return(0,g.jsx)(s.Z.Brand,{children:(0,g.jsx)(o.Z.Link,{title:a("titre"),children:(0,g.jsx)(p.c,{children:"titre"})})})}),[a]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(f.Menu,{brand:Z,labelMenu:"Menu",etatConnexion:m,onSelect:function(e){switch(e){case"applications":break;case"information":k(!0);break;case"deconnecter":!function(e){b.apply(this,arguments)}(r);break;case"SectionAjouterMethode":case"SectionActiverCompte":case"SectionActiverDelegation":t(e)}},workers:r,children:[(0,g.jsx)(o.Z.Link,{eventKey:"information",title:"Afficher l'information systeme",children:(0,g.jsx)(p.c,{children:"menu.information"})}),(0,g.jsxs)(u.Z,{title:"Compte",id:"compte-nav-dropdown",children:[(0,g.jsx)(u.Z.Item,{eventKey:"SectionAjouterMethode",children:"Ajouter cle"}),(0,g.jsx)(u.Z.Item,{eventKey:"SectionActiverCompte",children:"Activer code"}),(0,g.jsx)(u.Z.Item,{eventKey:"SectionActiverDelegation",children:"Administrer"})]}),(0,g.jsxs)(f.DropDownLanguage,{title:a("menu.language"),onSelect:function(e){n.changeLanguage(e)},children:[(0,g.jsx)(u.Z.Item,{eventKey:"en-US",children:"English"}),(0,g.jsx)(u.Z.Item,{eventKey:"fr-CA",children:"Francais"})]}),(0,g.jsx)(o.Z.Link,{eventKey:"deconnecter",title:a("deconnecter"),children:(0,g.jsx)(p.c,{children:"menu.deconnecter"})})]}),(0,g.jsx)(f.ModalInfo,{show:x,fermer:w,manifest:v()})]})}},74405:function(e,n,t){"use strict";t.d(n,{Gd:function(){return w},L5:function(){return P},Ry:function(){return y},ei:function(){return v},q3:function(){return g},rg:function(){return m}});var r=t(37762),a=t(74165),i=t(1413),c=t(93433),o=t(15861),s=t(31243),u=t(20829),l=t(5894),p=t(98052),f=t(83653),d=t(19778).Buffer;function m(e,n,t){return h.apply(this,arguments)}function h(){return(h=(0,o.Z)((0,a.Z)().mark((function e(n,t,r){var o,s,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},o=f.pki.certificateFromPem(t[0]),(s=o.subject.getField("CN").value)===n){e.next=5;break}throw new Error("Certificat pour le mauvais usager : ".concat(s," !== ").concat(n));case 5:if(!((l=(0,c.Z)(t)).length<2)){e.next=8;break}throw new Error("Certificat recu n'a pas intermediaire/CA (len=".concat(t.length,"): ").concat(t.join("")));case 8:return p=(0,i.Z)((0,i.Z)({},r),{},{requete:null}),3===l.length&&(p.ca=l.pop()),p.certificat=l,e.next=13,u.usagerDao.updateUsager(n,p);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){var n=e;return"string"===typeof e&&(n=f.pki.certificateFromPem(e)),(0,l.extraireExtensionsMillegrille)(n).userId}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,o.Z)((0,a.Z)().mark((function e(n){var t,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.genererClePrivee)();case 2:return t=e.sent,r=d.from(t.publicKey.publicKeyBytes).toString("hex"),console.debug("Fingerprint publickey : %O \n(bytes : %O)",r,t.publicKey.publicKeyBytes),e.next=7,(0,p.genererCsrNavigateur)(n,t.pem);case 7:return i=e.sent,e.abrupt("return",{fingerprint_pk:r,csr:i,clePriveePem:t.pem});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,n){return x.apply(this,arguments)}function x(){return(x=(0,o.Z)((0,a.Z)().mark((function e(n,t){var r,c,o,s,l,p,f,d,m,h,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t={}),n){e.next=3;break}throw new Error("Usager null");case 3:return e.next=5,u.usagerDao.getUsager(n);case 5:if(r=e.sent,c=r?r.certificat:null,o=!1,r){e.next=12;break}o=!0,e.next=28;break;case 12:if(!0!==t.regenerer){e.next=16;break}o=!0,e.next=28;break;case 16:if(c||r.requete){e.next=20;break}o=!0,e.next=28;break;case 20:if(!c){e.next=28;break}if(s=k(c),l=s.certificatValide,p=s.canRenew,l){e.next=27;break}return e.next=25,u.usagerDao.updateUsager(n,{nomUsager:n,certificat:null,clePriveePem:null,fingerprintPk:null});case 25:r.certificat=null,r.clePriveePem=null;case 27:!p&&l||(console.warn("Certificat invalide ou date de renouvellement atteinte"),o=!0);case 28:if(!o){e.next=37;break}return e.next=31,g(n);case 31:return f=e.sent,d=f.csr,m=f.clePriveePem,h=f.fingerprint_pk,v={csr:d,clePriveePem:m,fingerprintPk:h},e.next=36,u.usagerDao.updateUsager(n,{nomUsager:n,requete:v});case 36:r=(0,i.Z)((0,i.Z)({},r),{},{nomUsager:n,requete:v});case 37:return e.abrupt("return",r);case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){var n=f.pki.certificateFromPem(e.join("")),t=n.validity.notAfter.getTime(),r=n.validity.notBefore.getTime(),a=(t-r)/3*2+r;return{certificatValide:(new Date).getTime()<t,canRenew:(new Date).getTime()>a}}function w(e,n,t,r){return Z.apply(this,arguments)}function Z(){return(Z=(0,o.Z)((0,a.Z)().mark((function e(n,t,r,c){var o,u,l,p,f,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=c||{},o=window.location.hostname,u=(0,i.Z)((0,i.Z)({nomUsager:n,hostname:o},c),{},{fingerprintPkNouveau:t,fingerprintPkCourant:r}),e.next=5,(0,s.Z)({method:"POST",url:"/auth/get_usager",data:u,timeout:2e4});case 5:return l=e.sent,p=l.data,f=JSON.parse(p.contenu),console.debug("chargerUsager Reponse ",f),d=!!f&&f.auth,e.abrupt("return",{nomUsager:n,infoUsager:f,authentifie:d});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=["collections","documents","messagerie"],O=["fichiersDechiffresTmp"];function P(){return E.apply(this,arguments)}function E(){return(E=(0,o.Z)((0,a.Z)().mark((function e(){var n,t,i,c,o,s,l,p,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("indexedDB"in window)){e.next=33;break}if(n=j,!("databases"in window.indexedDB)){e.next=8;break}return console.debug("Supporte indexedDB.databases()"),e.next=6,window.indexedDB.databases();case 6:n=e.sent,console.log(n);case 8:t=[],i=(0,r.Z)(n),e.prev=10,o=(0,a.Z)().mark((function e(){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("millegrilles"!==(n=c.value)){e.next=3;break}return e.abrupt("return",1);case 3:console.debug("Supprimer database %s",n),r=new Promise((function(e,t){var r=window.indexedDB.deleteDatabase(n);r.onblocked=function(e){console.warn("delete blocked sur database %s : %O",n,e)},r.onerror=function(t){console.warn("Erreur suppression database %s : %O",n,t),e()},r.onsuccess=function(){console.debug("Database %s supprimee",n),e()}})),t.push(r);case 6:case"end":return e.stop()}}),e)})),i.s();case 13:if((c=i.n()).done){e.next=19;break}return e.delegateYield(o(),"t0",15);case 15:if(!e.t0){e.next=17;break}return e.abrupt("continue",17);case 17:e.next=13;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(10),i.e(e.t1);case 24:return e.prev=24,i.f(),e.finish(24);case 27:if(t.push(u.usagerDao.clearClesDechiffrees()),caches){s=caches,l=(0,r.Z)(O);try{for(l.s();!(p=l.n()).done;)f=p.value,t.push(s.delete(f))}catch(d){l.e(d)}finally{l.f()}}return e.next=31,Promise.all(t);case 31:e.next=34;break;case 33:console.debug("IDB non supporte");case 34:case"end":return e.stop()}}),e,null,[[10,21,24,27]])})))).apply(this,arguments)}},93183:function(e){e.exports={date:"2023-09-30 15:56",version:"2023.9.0"}},2869:function(e,n,t){"use strict";t.d(n,{c:function(){return y}});var r=t(45987),a=t(71002),i=t(4942),c=t(72791),o=t(85326),s=t(38589),u=t(81426),l=["format"],p=["children","count","parent","i18nKey","context","tOptions","values","defaults","components","ns","i18n","t","shouldUnescape"];function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){(0,i.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function m(e,n){if(!e)return!1;var t=e.props?e.props.children:e.children;return n?t.length>0:!!t}function h(e){return e?e.props?e.props.children:e.children:[]}function v(e){return Array.isArray(e)?e:[e]}function g(e,n){if(!e)return"";var t="",i=v(e),o=n.transSupportBasicHtmlNodes&&n.transKeepBasicHtmlNodesFor?n.transKeepBasicHtmlNodesFor:[];return i.forEach((function(e,i){if("string"===typeof e)t+="".concat(e);else if((0,c.isValidElement)(e)){var s=Object.keys(e.props).length,p=o.indexOf(e.type)>-1,f=e.props.children;if(!f&&p&&0===s)t+="<".concat(e.type,"/>");else if(f||p&&0===s)if(e.props.i18nIsDynamicList)t+="<".concat(i,"></").concat(i,">");else if(p&&1===s&&"string"===typeof f)t+="<".concat(e.type,">").concat(f,"</").concat(e.type,">");else{var d=g(f,n);t+="<".concat(i,">").concat(d,"</").concat(i,">")}else t+="<".concat(i,"></").concat(i,">")}else if(null===e)(0,u.ZK)("Trans: the passed in value is invalid - seems you passed in a null child.");else if("object"===(0,a.Z)(e)){var m=e.format,h=(0,r.Z)(e,l),v=Object.keys(h);if(1===v.length){var b=m?"".concat(v[0],", ").concat(m):v[0];t+="{{".concat(b,"}}")}else(0,u.ZK)("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",e)}else(0,u.ZK)("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",e)})),t}function b(e,n,t,r,i,s){if(""===n)return[];var u=r.transKeepBasicHtmlNodesFor||[],l=n&&new RegExp(u.join("|")).test(n);if(!e&&!l)return[n];var p={};!function e(n){v(n).forEach((function(n){"string"!==typeof n&&(m(n)?e(h(n)):"object"!==(0,a.Z)(n)||(0,c.isValidElement)(n)||Object.assign(p,n))}))}(e);var f=o.Z.parse("<0>".concat(n,"</0>")),g=d(d({},p),i);function b(e,n,t){var r=h(e),a=x(r,n.children,t);return function(e){return"[object Array]"===Object.prototype.toString.call(e)&&e.every((function(e){return(0,c.isValidElement)(e)}))}(r)&&0===a.length?r:a}function y(e,n,t,r,a){e.dummy&&(e.children=n),t.push((0,c.cloneElement)(e,d(d({},e.props),{},{key:r}),a?void 0:n))}function x(n,i,o){var p=v(n);return v(i).reduce((function(n,i,f){var h=i.children&&i.children[0]&&i.children[0].content&&t.services.interpolator.interpolate(i.children[0].content,g,t.language);if("tag"===i.type){var v=p[parseInt(i.name,10)];!v&&1===o.length&&o[0][i.name]&&(v=o[0][i.name]),v||(v={});var k=0!==Object.keys(i.attrs).length?function(e,n){var t=d({},n);return t.props=Object.assign(e.props,n.props),t}({props:i.attrs},v):v,w=(0,c.isValidElement)(k),Z=w&&m(i,!0)&&!i.voidElement,j=l&&"object"===(0,a.Z)(k)&&k.dummy&&!w,O="object"===(0,a.Z)(e)&&null!==e&&Object.hasOwnProperty.call(e,i.name);if("string"===typeof k){var P=t.services.interpolator.interpolate(k,g,t.language);n.push(P)}else if(m(k)||Z){y(k,b(k,i,o),n,f)}else if(j){var E=x(p,i.children,o);n.push((0,c.cloneElement)(k,d(d({},k.props),{},{key:f}),E))}else if(Number.isNaN(parseFloat(i.name))){if(O)y(k,b(k,i,o),n,f,i.voidElement);else if(r.transSupportBasicHtmlNodes&&u.indexOf(i.name)>-1)if(i.voidElement)n.push((0,c.createElement)(i.name,{key:"".concat(i.name,"-").concat(f)}));else{var D=x(p,i.children,o);n.push((0,c.createElement)(i.name,{key:"".concat(i.name,"-").concat(f)},D))}else if(i.voidElement)n.push("<".concat(i.name," />"));else{var S=x(p,i.children,o);n.push("<".concat(i.name,">").concat(S,"</").concat(i.name,">"))}}else if("object"!==(0,a.Z)(k)||w)1===i.children.length&&h?n.push((0,c.cloneElement)(k,d(d({},k.props),{},{key:f}),h)):n.push((0,c.cloneElement)(k,d(d({},k.props),{},{key:f})));else{var K=i.children[0]?h:null;K&&n.push(K)}}else if("text"===i.type){var C=r.transWrapTextNodes,A=s?r.unescape(t.services.interpolator.interpolate(i.content,g,t.language)):t.services.interpolator.interpolate(i.content,g,t.language);C?n.push((0,c.createElement)(C,{key:"".concat(i.name,"-").concat(f)},A)):n.push(A)}return n}),[])}return h(x([{dummy:!0,children:e||[]}],f,v(e||[]))[0])}function y(e){var n=e.children,t=e.count,a=e.parent,i=e.i18nKey,o=e.context,l=e.tOptions,f=void 0===l?{}:l,m=e.values,h=e.defaults,v=e.components,y=e.ns,x=e.i18n,k=e.t,w=e.shouldUnescape,Z=(0,r.Z)(e,p),j=(0,c.useContext)(s.OO)||{},O=j.i18n,P=j.defaultNS,E=x||O||(0,s.nI)();if(!E)return(0,u.O4)("You will need to pass in an i18next instance by using i18nextReactModule"),n;var D=k||E.t.bind(E)||function(e){return e};o&&(f.context=o);var S=d(d({},(0,s.JP)()),E.options&&E.options.react),K=y||D.ns||P||E.options&&E.options.defaultNS;K="string"===typeof K?[K]:K||["translation"];var C=h||g(n,S)||S.transEmptyNodeValue||i,A=S.hashTransKey,B=i||(A?A(C):C),N=m?f.interpolation:{interpolation:d(d({},f.interpolation),{},{prefix:"#$?",suffix:"?$#"})},U=d(d(d(d({},f),{},{count:t},m),N),{},{defaultValue:C,ns:K}),F=b(v||n,B?D(B,U):C,E,S,U,w),I=void 0!==a?a:S.defaultTransParent;return I?(0,c.createElement)(I,Z,F):F}}}]);
//# sourceMappingURL=585.511d8158.chunk.js.map